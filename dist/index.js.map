{"version":3,"file":"index.js","mappings":"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","sources":["webpack://sql.js-httpvfs/webpack/universalModuleDefinition","webpack://sql.js-httpvfs/./src/db.ts","webpack://sql.js-httpvfs/./src/index.ts","webpack://sql.js-httpvfs/./node_modules/comlink/dist/esm/comlink.mjs","webpack://sql.js-httpvfs/webpack/bootstrap","webpack://sql.js-httpvfs/webpack/runtime/define property getters","webpack://sql.js-httpvfs/webpack/runtime/hasOwnProperty shorthand","webpack://sql.js-httpvfs/webpack/runtime/make namespace object","webpack://sql.js-httpvfs/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, () => {\nreturn ","/// <reference lib=\"dom\" />\n/// <reference lib=\"dom.iterable\" />\n\n// TODO: using comlink for all this is a pretty ugly hack\nimport * as Comlink from \"comlink\";\n\nimport {\n  LazyHttpDatabase,\n  SplitFileConfig,\n  SqliteComlinkMod,\n} from \"./sqlite.worker\";\n\nimport { DomRow, MainThreadRequest } from \"./vtab\";\n\nComlink.transferHandlers.set(\"WORKERSQLPROXIES\", {\n  canHandle: (obj): obj is unknown => false,\n  serialize(obj) {\n    throw Error(\"no\");\n  },\n  deserialize: (port: MessagePort) => {\n    port.start();\n    return Comlink.wrap(port);\n  },\n});\nexport type SqliteWorker = Comlink.Remote<SqliteComlinkMod>;\nexport interface WorkerHttpvfs {\n  db: Comlink.Remote<LazyHttpDatabase>;\n  worker: Comlink.Remote<SqliteComlinkMod>;\n  configs: SplitFileConfig[];\n  release: () => void;\n}\nexport async function createDbWorker(\n  configs: SplitFileConfig[],\n  workerUrl: string,\n  wasmUrl: string,\n  maxBytesToRead: number = Infinity\n): Promise<WorkerHttpvfs> {\n  const worker: Worker = new Worker(workerUrl);\n  const sqlite = Comlink.wrap<SqliteComlinkMod>(worker);\n\n  const db = ((await sqlite.SplitFileHttpDatabase(\n    wasmUrl,\n    configs,\n    undefined,\n    maxBytesToRead\n  )) as unknown) as Comlink.Remote<LazyHttpDatabase>;\n  const release = () => {\n    db[Comlink.releaseProxy]();\n    sqlite[Comlink.releaseProxy]();\n    worker.terminate();\n  }\n\n  worker.addEventListener(\"message\", handleAsyncRequestFromWorkerThread);\n  return { db, worker: sqlite, configs, release };\n}\n\nasync function handleAsyncRequestFromWorkerThread(ev: MessageEvent) {\n  if (ev.data && ev.data.action === \"eval\") {\n    const metaArray = new Int32Array(ev.data.notify, 0, 2);\n    const dataArray = new Uint8Array(ev.data.notify, 2 * 4);\n    let response;\n    try {\n      response = { ok: await handleDomVtableRequest(ev.data.request) };\n    } catch (e) {\n      console.error(\"worker request error\", ev.data.request, e);\n      response = { err: String(e) };\n    }\n    const text = new TextEncoder().encode(JSON.stringify(response));\n    dataArray.set(text, 0); // need to copy here because:\n    // sadly TextEncoder.encodeInto: Argument 2 can't be a SharedArrayBuffer or an ArrayBufferView backed by a SharedArrayBuffer [AllowShared]\n    // otherwise this would be better:\n    /*const encodeRes = new TextEncoder().encodeInto(response, data);\n    if (encodeRes.read !== response.length) {\n      console.log(encodeRes, response.length)\n      throw Error(`not enough space for response: ${response.length} > ${data.byteLength}`);\n    }*/\n    metaArray[1] = text.length;\n    Atomics.notify(metaArray, 0);\n  }\n}\nfunction getUniqueSelector(elm: Element) {\n  if (elm.tagName === \"BODY\") return \"body\";\n  const names = [];\n  while (elm.parentElement && elm.tagName !== \"BODY\") {\n    if (elm.id) {\n      // assume id is unique (which it isn't)\n      names.unshift(\"#\" + elm.id);\n      break;\n    } else {\n      let c = 1;\n      let e = elm;\n      while (e.previousElementSibling) {\n        e = e.previousElementSibling;\n        c++;\n      }\n      names.unshift(elm.tagName.toLowerCase() + \":nth-child(\" + c + \")\");\n    }\n    elm = elm.parentElement;\n  }\n  return names.join(\" > \");\n}\n\nfunction keys<T>(o: T): (keyof T)[] {\n  return Object.keys(o) as (keyof T)[];\n}\nasync function handleDomVtableRequest(\n  req: MainThreadRequest\n): Promise<Partial<DomRow>[] | null> {\n  console.log(\"dom vtable request\", req);\n  if (req.type === \"select\") {\n    return [...document.querySelectorAll(req.selector)].map((e) => {\n      const out: Partial<DomRow> = {};\n      for (const column of req.columns) {\n        if (column === \"selector\") {\n          out.selector = getUniqueSelector(e);\n        } else if (column === \"parent\") {\n          if (e.parentElement) {\n            out.parent = e.parentElement\n              ? getUniqueSelector(e.parentElement)\n              : null;\n          }\n        } else if (column === \"idx\") {\n          // ignore\n        } else {\n          out[column] = e[column] as string;\n        }\n      }\n      return out;\n    });\n  } else if (req.type === \"insert\") {\n    if (!req.value.parent)\n      throw Error(`\"parent\" column must be set when inserting`);\n    const target = document.querySelectorAll(req.value.parent);\n    if (target.length === 0)\n      throw Error(`Parent element ${req.value.parent} could not be found`);\n    if (target.length > 1)\n      throw Error(\n        `Parent element ${req.value.parent} ambiguous (${target.length} results)`\n      );\n    const parent = target[0];\n    if (!req.value.tagName) throw Error(`tagName must be set for inserting`);\n    const ele = document.createElement(req.value.tagName);\n    const cantSet = [\"idx\"];\n    for (const i of keys(req.value)) {\n      if (req.value[i] !== null) {\n        if (i === \"tagName\" || i === \"parent\") continue;\n        if (i === \"idx\" || i === \"selector\") throw Error(`${i} can't be set`);\n\n        ele[i] = req.value[i] as any;\n      }\n    }\n    parent.appendChild(ele);\n    return null;\n  } else if (req.type === \"update\") {\n    const targetElement = document.querySelector(req.value.selector!);\n    if (!targetElement) throw Error(`Element ${req.value.selector} not found!`);\n    const toSet: (\n      | \"innerHTML\"\n      | \"id\"\n      | \"textContent\"\n      | \"innerHTML\"\n      | \"outerHTML\"\n      | \"className\"\n    )[] = [];\n    for (const k of keys(req.value)) {\n      const v = req.value[k];\n      if (k === \"parent\") {\n        if (v !== getUniqueSelector(targetElement.parentElement!)) {\n          const targetParent = document.querySelectorAll(v as string);\n          if (targetParent.length !== 1)\n            throw Error(\n              `Invalid target parent: found ${targetParent.length} matches`\n            );\n          targetParent[0].appendChild(targetElement);\n        }\n        continue;\n      }\n      if (k === \"idx\" || k === \"selector\") continue;\n      if (v !== targetElement[k]) {\n        console.log(\"SETTING \", k, targetElement[k], \"->\", v);\n        if (k === \"tagName\") throw Error(\"can't change tagName\");\n        toSet.push(k); // defer setting to prevent setting multiple interdependent values (e.g. textContent and innerHTML)\n      }\n    }\n    for (const k of toSet) {\n      targetElement[k] = req.value[k] as string;\n    }\n    return null;\n  } else {\n    throw Error(`unknown request ${req.type}`);\n  }\n}\n","export * from \"./db\";\nexport type { SqliteStats } from \"./sqlite.worker\";\nexport type { PageReadLog } from \"./lazyFile\";\n","/**\r\n * Copyright 2019 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst proxyMarker = Symbol(\"Comlink.proxy\");\r\nconst createEndpoint = Symbol(\"Comlink.endpoint\");\r\nconst releaseProxy = Symbol(\"Comlink.releaseProxy\");\r\nconst throwMarker = Symbol(\"Comlink.thrown\");\r\nconst isObject = (val) => (typeof val === \"object\" && val !== null) || typeof val === \"function\";\r\n/**\r\n * Internal transfer handle to handle objects marked to proxy.\r\n */\r\nconst proxyTransferHandler = {\r\n    canHandle: (val) => isObject(val) && val[proxyMarker],\r\n    serialize(obj) {\r\n        const { port1, port2 } = new MessageChannel();\r\n        expose(obj, port1);\r\n        return [port2, [port2]];\r\n    },\r\n    deserialize(port) {\r\n        port.start();\r\n        return wrap(port);\r\n    },\r\n};\r\n/**\r\n * Internal transfer handler to handle thrown exceptions.\r\n */\r\nconst throwTransferHandler = {\r\n    canHandle: (value) => isObject(value) && throwMarker in value,\r\n    serialize({ value }) {\r\n        let serialized;\r\n        if (value instanceof Error) {\r\n            serialized = {\r\n                isError: true,\r\n                value: {\r\n                    message: value.message,\r\n                    name: value.name,\r\n                    stack: value.stack,\r\n                },\r\n            };\r\n        }\r\n        else {\r\n            serialized = { isError: false, value };\r\n        }\r\n        return [serialized, []];\r\n    },\r\n    deserialize(serialized) {\r\n        if (serialized.isError) {\r\n            throw Object.assign(new Error(serialized.value.message), serialized.value);\r\n        }\r\n        throw serialized.value;\r\n    },\r\n};\r\n/**\r\n * Allows customizing the serialization of certain values.\r\n */\r\nconst transferHandlers = new Map([\r\n    [\"proxy\", proxyTransferHandler],\r\n    [\"throw\", throwTransferHandler],\r\n]);\r\nfunction expose(obj, ep = self) {\r\n    ep.addEventListener(\"message\", function callback(ev) {\r\n        if (!ev || !ev.data) {\r\n            return;\r\n        }\r\n        const { id, type, path } = Object.assign({ path: [] }, ev.data);\r\n        const argumentList = (ev.data.argumentList || []).map(fromWireValue);\r\n        let returnValue;\r\n        try {\r\n            const parent = path.slice(0, -1).reduce((obj, prop) => obj[prop], obj);\r\n            const rawValue = path.reduce((obj, prop) => obj[prop], obj);\r\n            switch (type) {\r\n                case 0 /* GET */:\r\n                    {\r\n                        returnValue = rawValue;\r\n                    }\r\n                    break;\r\n                case 1 /* SET */:\r\n                    {\r\n                        parent[path.slice(-1)[0]] = fromWireValue(ev.data.value);\r\n                        returnValue = true;\r\n                    }\r\n                    break;\r\n                case 2 /* APPLY */:\r\n                    {\r\n                        returnValue = rawValue.apply(parent, argumentList);\r\n                    }\r\n                    break;\r\n                case 3 /* CONSTRUCT */:\r\n                    {\r\n                        const value = new rawValue(...argumentList);\r\n                        returnValue = proxy(value);\r\n                    }\r\n                    break;\r\n                case 4 /* ENDPOINT */:\r\n                    {\r\n                        const { port1, port2 } = new MessageChannel();\r\n                        expose(obj, port2);\r\n                        returnValue = transfer(port1, [port1]);\r\n                    }\r\n                    break;\r\n                case 5 /* RELEASE */:\r\n                    {\r\n                        returnValue = undefined;\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n        catch (value) {\r\n            returnValue = { value, [throwMarker]: 0 };\r\n        }\r\n        Promise.resolve(returnValue)\r\n            .catch((value) => {\r\n            return { value, [throwMarker]: 0 };\r\n        })\r\n            .then((returnValue) => {\r\n            const [wireValue, transferables] = toWireValue(returnValue);\r\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\r\n            if (type === 5 /* RELEASE */) {\r\n                // detach and deactive after sending release response above.\r\n                ep.removeEventListener(\"message\", callback);\r\n                closeEndPoint(ep);\r\n            }\r\n        });\r\n    });\r\n    if (ep.start) {\r\n        ep.start();\r\n    }\r\n}\r\nfunction isMessagePort(endpoint) {\r\n    return endpoint.constructor.name === \"MessagePort\";\r\n}\r\nfunction closeEndPoint(endpoint) {\r\n    if (isMessagePort(endpoint))\r\n        endpoint.close();\r\n}\r\nfunction wrap(ep, target) {\r\n    return createProxy(ep, [], target);\r\n}\r\nfunction throwIfProxyReleased(isReleased) {\r\n    if (isReleased) {\r\n        throw new Error(\"Proxy has been released and is not useable\");\r\n    }\r\n}\r\nfunction createProxy(ep, path = [], target = function () { }) {\r\n    let isProxyReleased = false;\r\n    const proxy = new Proxy(target, {\r\n        get(_target, prop) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            if (prop === releaseProxy) {\r\n                return () => {\r\n                    return requestResponseMessage(ep, {\r\n                        type: 5 /* RELEASE */,\r\n                        path: path.map((p) => p.toString()),\r\n                    }).then(() => {\r\n                        closeEndPoint(ep);\r\n                        isProxyReleased = true;\r\n                    });\r\n                };\r\n            }\r\n            if (prop === \"then\") {\r\n                if (path.length === 0) {\r\n                    return { then: () => proxy };\r\n                }\r\n                const r = requestResponseMessage(ep, {\r\n                    type: 0 /* GET */,\r\n                    path: path.map((p) => p.toString()),\r\n                }).then(fromWireValue);\r\n                return r.then.bind(r);\r\n            }\r\n            return createProxy(ep, [...path, prop]);\r\n        },\r\n        set(_target, prop, rawValue) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            // FIXME: ES6 Proxy Handler `set` methods are supposed to return a\r\n            // boolean. To show good will, we return true asynchronously ¯\\_(ツ)_/¯\r\n            const [value, transferables] = toWireValue(rawValue);\r\n            return requestResponseMessage(ep, {\r\n                type: 1 /* SET */,\r\n                path: [...path, prop].map((p) => p.toString()),\r\n                value,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n        apply(_target, _thisArg, rawArgumentList) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            const last = path[path.length - 1];\r\n            if (last === createEndpoint) {\r\n                return requestResponseMessage(ep, {\r\n                    type: 4 /* ENDPOINT */,\r\n                }).then(fromWireValue);\r\n            }\r\n            // We just pretend that `bind()` didn’t happen.\r\n            if (last === \"bind\") {\r\n                return createProxy(ep, path.slice(0, -1));\r\n            }\r\n            const [argumentList, transferables] = processArguments(rawArgumentList);\r\n            return requestResponseMessage(ep, {\r\n                type: 2 /* APPLY */,\r\n                path: path.map((p) => p.toString()),\r\n                argumentList,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n        construct(_target, rawArgumentList) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            const [argumentList, transferables] = processArguments(rawArgumentList);\r\n            return requestResponseMessage(ep, {\r\n                type: 3 /* CONSTRUCT */,\r\n                path: path.map((p) => p.toString()),\r\n                argumentList,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n    });\r\n    return proxy;\r\n}\r\nfunction myFlat(arr) {\r\n    return Array.prototype.concat.apply([], arr);\r\n}\r\nfunction processArguments(argumentList) {\r\n    const processed = argumentList.map(toWireValue);\r\n    return [processed.map((v) => v[0]), myFlat(processed.map((v) => v[1]))];\r\n}\r\nconst transferCache = new WeakMap();\r\nfunction transfer(obj, transfers) {\r\n    transferCache.set(obj, transfers);\r\n    return obj;\r\n}\r\nfunction proxy(obj) {\r\n    return Object.assign(obj, { [proxyMarker]: true });\r\n}\r\nfunction windowEndpoint(w, context = self, targetOrigin = \"*\") {\r\n    return {\r\n        postMessage: (msg, transferables) => w.postMessage(msg, targetOrigin, transferables),\r\n        addEventListener: context.addEventListener.bind(context),\r\n        removeEventListener: context.removeEventListener.bind(context),\r\n    };\r\n}\r\nfunction toWireValue(value) {\r\n    for (const [name, handler] of transferHandlers) {\r\n        if (handler.canHandle(value)) {\r\n            const [serializedValue, transferables] = handler.serialize(value);\r\n            return [\r\n                {\r\n                    type: 3 /* HANDLER */,\r\n                    name,\r\n                    value: serializedValue,\r\n                },\r\n                transferables,\r\n            ];\r\n        }\r\n    }\r\n    return [\r\n        {\r\n            type: 0 /* RAW */,\r\n            value,\r\n        },\r\n        transferCache.get(value) || [],\r\n    ];\r\n}\r\nfunction fromWireValue(value) {\r\n    switch (value.type) {\r\n        case 3 /* HANDLER */:\r\n            return transferHandlers.get(value.name).deserialize(value.value);\r\n        case 0 /* RAW */:\r\n            return value.value;\r\n    }\r\n}\r\nfunction requestResponseMessage(ep, msg, transfers) {\r\n    return new Promise((resolve) => {\r\n        const id = generateUUID();\r\n        ep.addEventListener(\"message\", function l(ev) {\r\n            if (!ev.data || !ev.data.id || ev.data.id !== id) {\r\n                return;\r\n            }\r\n            ep.removeEventListener(\"message\", l);\r\n            resolve(ev.data);\r\n        });\r\n        if (ep.start) {\r\n            ep.start();\r\n        }\r\n        ep.postMessage(Object.assign({ id }, msg), transfers);\r\n    });\r\n}\r\nfunction generateUUID() {\r\n    return new Array(4)\r\n        .fill(0)\r\n        .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\r\n        .join(\"-\");\r\n}\n\nexport { createEndpoint, expose, proxy, proxyMarker, releaseProxy, transfer, transferHandlers, windowEndpoint, wrap };\n//# sourceMappingURL=comlink.mjs.map\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(432);\n"],"names":["root","factory","exports","module","define","amd","a","i","this","async","handleAsyncRequestFromWorkerThread","ev","data","action","metaArray","Int32Array","notify","dataArray","Uint8Array","response","ok","handleDomVtableRequest","request","e","console","error","err","String","text","TextEncoder","encode","JSON","stringify","set","length","Atomics","getUniqueSelector","elm","tagName","names","parentElement","id","unshift","c","previousElementSibling","toLowerCase","join","keys","o","Object","req","log","type","document","querySelectorAll","selector","map","out","column","columns","parent","value","Error","target","ele","createElement","appendChild","targetElement","querySelector","toSet","k","v","push","targetParent","Comlink","transferHandlers","canHandle","obj","serialize","deserialize","port","start","wrap","configs","workerUrl","wasmUrl","maxBytesToRead","Infinity","worker","Worker","sqlite","db","SplitFileHttpDatabase","undefined","addEventListener","release","releaseProxy","terminate","proxyMarker","Symbol","createEndpoint","throwMarker","isObject","val","Map","port1","port2","MessageChannel","expose","serialized","isError","message","name","stack","assign","ep","self","callback","path","argumentList","fromWireValue","returnValue","slice","reduce","prop","rawValue","apply","proxy","transfer","Promise","resolve","catch","then","wireValue","transferables","toWireValue","postMessage","removeEventListener","closeEndPoint","endpoint","constructor","isMessagePort","close","createProxy","throwIfProxyReleased","isReleased","isProxyReleased","Proxy","get","_target","requestResponseMessage","p","toString","r","bind","_thisArg","rawArgumentList","last","processArguments","construct","processed","arr","Array","prototype","concat","transferCache","WeakMap","transfers","windowEndpoint","w","context","targetOrigin","msg","handler","serializedValue","fill","Math","floor","random","Number","MAX_SAFE_INTEGER","l","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","call","d","definition","key","defineProperty","enumerable","hasOwnProperty","toStringTag"],"sourceRoot":""}